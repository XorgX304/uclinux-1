echo "/etc/rc processing ..."
echo "Starting watchdog ..."
watchdog /dev/watchdog
hostname sVPN
echo "Making Filesystems ..."
expand /etc/ramfs.img /dev/ram1
expand /etc/ramfs.img /dev/ram2
echo "Mounting Filesystems ..."
mount -t proc proc /proc
echo 2 >/proc/cpu/alignment
mount -t ext2 /dev/ram1 /var
mount -t ext2 /dev/ram2 /etc/config
mkdir -m 1777 /var/tmp
mkdir -m 755 /var/log
mkdir -m 755 /var/run
mkdir -m 1777 /var/lock
mkdir -m 755 /var/empty
mkdir -m 755 /var/mnt
logd boot
echo "Processing Config Filesystem ..."
flatfsd -r -n
echo "Loading network drivers."
modprobe ixp400
modprobe ixp425_npe
rmmod ixp425_npe
modprobe ixp425_eth
setmac -o 0x1c000
echo 1 >/proc/sys/net/ipv4/conf/all/promote_secondaries
echo "Checking CF socket ..."
ivpnset eth1 0
ivpnset wifi 1
cardctl eject
cardctl reset
cardctl insert
if (cardctl ident | grep "no product info") ; then 
cardctl eject
ivpnset wifi 0
else
modprobe hostap_crypt
modprobe hostap_crypt_wep
modprobe hostap
modprobe hostap_cs
cardctl bind hostap_cs
ifconfig eth2 up
fi
modprobe authd
initconf -v
ifconfig eth2 down
cardctl unbind hostap_cs
cardctl eject
ivpnset wifi 0
ifconfig lo 127.0.0.1
echo "/etc/rc complete."
